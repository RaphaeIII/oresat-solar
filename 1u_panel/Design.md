# OreSat Solar Module v2## Everything is terrible (architecture)The system architecture of OreSat is weird, and possibly seriously dumb. However, it has a lot of advantages that, despite it's dumbness, are a system-win. One of those dumb ideas that might be either a terrible, terrible mistake or a brilliant stroke of insight (emphasis, possibly, on the stroke) is that the Vbus is based on the Vbat which are two series Lipo cells. Meaning, the Vbus ranges from 6.0 to 8.4 V. Yep. We told you. Brilliant or dumbass. Ask us in 2020 and we'll let you know.Based on that, we wanted a maximum power point tracer (MPPT) that could take our solar array input and buck/boost that to the 8.4V necessary to charge the battery. Thus there's only one SPS between the array and the batteries, and it's MPPT. A true MPPT, mind you, not one of these namby pamby "70% Voc" maximum power point "controllers".Finally, we were very interested in a modular array that could stand on it's own, even on a 1U, so we decided to make a single module that stood on its own and could be paralleled with other modules.## Solar arrayThe array will be Alta Devices Inc Gallium Arsenide (GaAs) chemical vapor deposition (CVD) thin film solar cells wired in series in a single "5 cell module". From their datasheet, which includes AM0 irradiance figures(!):    Voc =  Ncells * Voc = 5 * 1.09V = 5.45V    Vmp = Ncells * Vmp = 5 * 0.97V = 4.85V    Isc = 244 mA     256 mA with no cover, but we're assuming a cover    Imp  = 231 mA    No cover = 236 mA but assume cover    Pmax/mp = Ncells * Pmp = 5 * 0.223W = 1.12 W## MPPT ICsRequirements:- (4.0, 4.85, 5.45) V input from the Alta Devices array.- 6.0 - 8.4 V output connected directly to our LiPo cells -- we don't want a separate battery charger.- MPPT, not MPPC.We are complete idiots and are implementing our own MPPT controlled by the onboard uC and the **LT1618** SPS.  The LT1618 is a boost supply with both a CC/CV modes.  The package features a current adjust pin that reads an analog voltage and adjusts the output to a corresponding current, the pin can be grounded for a CV mode.  Our Sensors will talk I2C to our uC which will calculate our MPPT, and send an analog voltage to the current adjust pin via an I2C DAC.  This design doubles as our battery charging regulator for the LiPo batteries as well as our MPPT.  For configuration and parts, see the [LT1618 design notes](LT1618.md).Stay tuned for specific MPPT algorithm details!## Sensor ICsWe choose the TI **INA226** to measure voltage, and current from the solar array.  Current is measured across the same shunt resistor that the LT1618 uses and talks I2C to our uC.   See the [INA226 design notes](INA226.md).We chose the TI **TMP100** as our temperature sensor.  It comes in an adorable SOT-23 package so we can flip that package upside down and fit the chip into a slot cut into the board so that we can get a more accurate temperature reading of the solar array.  Also has the benefit of working of a wide temperature range and talking I2C to our uC.**Note: Since the temperature sensor is flipped upside down and fits into a slot in the board, the pins will be flipped from the pinout on the datasheet**## MicrocontrollerFor many reasons, we're using the ST **STM32F042K6**, which is a TQFP 32 pin Cortex M0 IC which talks CAN. We're using it all over the place on OreSat. And we choose the TI **TCAN330** as the CAN transceiver.## 3.3 V SPSAfter looking at a billion 3.3V switcher ICs, we really like the TI **TPS63020**. The final system footprint is large, but it does buck-boost so that we can get 3.3V even if our batteries are down to their 3.0V minimum voltage. Also, temporary brownouts should be OK given the boost and the giant capacitor banks the TPS63070 requires. See the [TPS63070 design notes](TPS63070.md)## OreSat ShutdownThe Remove Before Flight (RBF) and rail inhibit switches all need to shut down OreSat. We have a "open collector" shutdown system; pulling the line to ground shuts down OreSat. The STM can decide to shut down it's local panel, too.Note that we want the ability to power cycle all the things; luckily, because space, the ZSPM4521 will be deep power cycled every time we go in the shadow of the earth. At that point, the hole solar board should power off because of the LTC4411 ideal diodes. We choose regular 1N4448 diodes for the shutdown path because of the horrific leakage current of Schottkey diodes at high temperatures. They leavek **10s of mA!!11!!**. That's a lot. So we choose a silicon diode, run at very low current, so the most the Vf will be is 0.7 V even at very low temperatures. We have to be careful, because the ZSPM4521's EN line has a minimum V_L of 0.8V, so we need to be well under that.