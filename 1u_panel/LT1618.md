# Analog Devices (Was Linear) LT1618This "Constant-Current/Constant-Voltage 1.4MHz Step-Up DC/DC Converter" forms the heart of our MPPT. It boosts the Alta Devices ~ 5V five cell array to the 2S battery pack's float voltage of 8.4V. Most critically, the LT1618 "combines a traditional voltage feedback loop and a unique current feedback loop to operate as a constant-current, constant-voltage source". So we'll use the constant-current to program the MPPT.How is this an MPPT? The LT1618 is capable of both CC and CV modes, where the I for the CC mode is selected via an analog voltage on the Iadj pin (pull to ground for CV).  We already have a V/I sensor along with an M0 microcontroller onboard the panel assembly.  The V/I sensor will constantly be reporting the output of the solar panels to the M0 over I2C, the M0 will calculate the MPP and output an analog voltage to the Iadj pin (via an external I2C DAC) to define a CC output that corresponds with the MPP.  Here's our existential crisis for the day: by the time we factor in the LT1618 efficiency, and the M0 and associated circuitry, will this be better than literally nothing but a boost supply and a battery charger? A good question. We think yes, the cold hard universe will be sure to let us know.Some Features we Like: - Massive Vin range (1.6V to 18V) - 1.4 MHz operating range - Current adjust pin that lets us define an I for CC mode or output at CV modeFeatures we don't like:- Operating range of -40 C (good) to +85 C (not quite the +100 C we want)- Maximum efficiency is only 85%. This is not very good for 2019.- We'd rather have a synchronous rectifier (switch MOSFET instead of the diode)## Design Inputs- Alta Devices 5 cell array at AM0 (assuming PEP cover)    - Voc = 5.45 V    - Isc = 244 mA   - Pmp = Vmp = 4.85 V x Imp = 231 mA = 1.12 W- Height   - All components must be < 2 mm tall due to component "pockets" cut into the frames.   - Components may not be placed      - On thermal interfaces to the frame      - On top of the card wedge's M2 fasteners, where clearance drops to ???? mm.- Temperature   - We expect the solar panels to swing wildly in temperature. All components should be rated for -40 to +100 C.## ComponentsReferences numbers are taken from the LT1618 datasheet, NOT from the solar module.**D1**Pick a Schottky diode that minimizes Vf and Ir. Ir becomes a real problem at high temperatures. We arbitrarily choose the ST Micro STPS1L40ZFY(1A, 40V, -40 to +175 C, Vf from 0.3 to 0.4V, Ir = 1 mA @ 125 C typ. and 10 mA max). Analog recommends the On Semi MBRM140 (1A, 40V, weird D0−216AA case, -55 to +125 C, Vf from 0.3 to 0.4V, Ir = 600 uA @ 85 C typ, and 10 mA (!!!) max.) which has almost the exact same performance.**L1**Datasheet recommends the SUMIDA CR43NP-100MC (10 +/-20 ％ UH, DCR = 0.182, Irms = 1.04, but 4.8 x 4.3 x 3.5 mm), which is too tall. We choose the BOURNS SRN4018TA-100M (10 +/- 20% uH, Fsrf = 35 MHz, DCR = 0.15 Ohm, Irms/Isat = 1.5A, -55 to +125 C, ferrite core, 4 x 4 x 1.8 mm), which also seems to have better performance.**Rsense**We chose 0.1 ohm in an 0603 package. We'll have a maximum of 0.02 V drop and 6 mW power dissipation at Isc. 0402 would have been fine, but in an 0602 package we can eke out a Kelvin connection on the inside of the package. With 0.1 ohms, the constant current limit is set to 50 mV/0.1 ohm = 0.5 A. We could double the resistance and get more signal on the current input, but we don't think we have to and we're trying to maximize efficiency.**R1/R2 Voltage Selection**Maximum charge voltage on the 2S pack is 8.4V. Select R2 to be 100k because that seems to be the datasheet's preferred value. R1 = R2 ( Vout / 1.263 - 1) = 565 k. Choose an E96 value of 562K, which gives  Vout = (R1/R2 + 1)*1.263 = 8.36V.**C1/C2**The input/output caps are just 0603 4.7 uF caps like in the datasheets. This seems OK, assuming the caps are rated for the temp and voltage (Vwdc >= 16V).## OperationSince the DAC on the Iadj input pin is off on power up, the LT1618 starts up with a CV output of 8.4V and a CC of 0.5A. This will instantly brown out the solar panel and cause the LT1618 to shut down and begin to power cycle. Since a boost converter, when off, is just a inductor and diode in series, the LT1618 can't just be disabled on boot. We'll need a switch downstream of the LT1618 (like an LT4412 ideal diode with a disable).The Iadj pin is used to set the current limit. CC mode happens wht Vi = 50 mV.     Imax = 50 mV/Rsense = 0.1 ohm = 0.5 AWith Viadj, this changes to:    Imax = (1.263V - (0.8)Viadj)/25/RsenseSo the range we can expect here is:    At Viadj = 0V, Imax = 0.505 A    At Viadj = 1.579 V, Imax = 0 AAlthough the hunt for Pmp is dependent on many variables, we would expect a cold array in full sun to have an output current of ~ 244 mA, which would set an Iadj    Viadj = (1.263 - Imax x 25 x Rsense)/0.8 = 0.816 V